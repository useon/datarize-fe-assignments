# Datarize 구매 데이터 대시보드

구매 빈도/고객 목록/고객 상세를 한 화면에서 빠르게 비교할 수 있는 대시보드를 구현했습니다.
(가격대별 구매 빈도 → 고객 목록 → 고객 상세 모달)

## 설계 의도

한 화면 안에서 기간을 바꾸면 모든 데이터가 동시에 반응해야 하므로, 날짜 범위를 최상단에서 통합 관리하고 섹션별 조회를 동일한 기준으로 맞추는 것이 중요하다고 생각했습니다.

## 폴더 구조

구매/고객은 요구사항과 데이터 흐름이 달라서 기능 중심으로 나눴고, 에러/로딩/유틸은 공통 영역으로 분리했습니다.

```
apps/frontend/src/
  api/ # API 모듈
  components/
    common/ # 공통 UI
    layout/ # 레이아웃
    purchase/ # 구매 빈도 섹션
    customers/ # 고객 목록/모달
  hooks/ # 공통 훅
  utils/ # 공통 유틸
  styles/ # 전역 스타일
```

## 기능별 구현 내용

### 가격대별 구매 빈도 + CSV 다운로드

- [x] 만원 단위 표기(2만원 이하 ~ 10만원 이상)
- [x] 날짜 범위에 따라 데이터 갱신
- [x] CSV 다운로드

### 고객 목록

- [x] 날짜 범위에 맞는 고객 목록 조회
- [x] 구매 금액 정렬(기본: ID 오름차순)
- [x] 이름 검색
- [x] 페이지네이션
- [x] 추가 구현: 한 페이지에 표시할 개수 선택
      -> 페이지네이션을 하는데 사용자가 한번에 보고 싶은 데이터를 선택할 수 있도록 하기 위해서 구현했습니다.

### 고객 상세 구매 내역

- [x] 고객 행 클릭 시 모달 표시
      -> 모달로 표시한 이유: 이미 페이지에 많은 정보들이 있어서 고객 상세 구매 내역 하단에 상세 정보를 위치하는 것 보다 모달로 띄워서 집중적으로 해당 정보를 볼 수 있도록 하기 위해 모달 형태로 구현하게 되었습니다.
- [x] 날짜 범위 적용
- [x] 구매 날짜/상품명/가격/수량/썸네일 포함
- [x] 추가 구현: 모달 외 영역 클릭 시 닫힘, 배경 스크롤 잠금
      -> 모달을 사용함으로써 모달에 필요한 부가적인 기능을 추가해서 사용자의 편리함을 높였습니다.

## 로딩, 에러, 재시도 처리

ErrorBoundary + Suspense fallback을 섹션별로 분리해, 한 영역의 오류가 다른 영역을 막지 않도록 처리했습니다.
따라서 UI 컴포넌트는 성공 상태의 화면에만 집중할 수 있고, 로딩/에러 분기는 공통 경계에서 일관되게 처리됩니다.

또한 TanStack Query의 useQueryErrorResetBoundary를 활용하여 다시 시도 버튼을 눌렀을 때 요청이 다시 가도록 구성했습니다.

## 캐싱 전략

TanStack Query를 이용하여, 섹션별 특성에 맞춰 캐싱 전략 및 기능을 다르게 설정했습니다.

- 구매 빈도: 60초 캐시로 과도한 재요청을 줄임
- 고객 목록/상세: 20초 캐시로 최신성을 조금 더 우선
- refetchOnWindowFocus 비활성화 + retry 1회로 불필요한 요청을 억제

## 테스트

Vite 환경이라 그대로 활용할 수 있는 Vitest 기준으로 유닛 테스트를 작성했습니다.

- [x] 가격대 표기 시나리오
- [x] CSV 생성 시나리오
- [x] 날짜 선택 시나리오

## 실행 방법

### 요구 버전

- Node.js: `22.17.0`
- Yarn: `1.22.22`

### 설치 및 실행

```bash
cd apps
yarn install

yarn start-server  # 백엔드 (http://localhost:4000)
yarn start-client  # 프론트엔드 (http://localhost:3000)
```

### 테스트 실행

```bash
cd apps
yarn workspace frontend test
```
